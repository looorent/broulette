<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BiteRoulette - The Lazy Edition</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- tsParticles -->
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700;900&family=Space+Grotesk:wght@700&family=Luckiest+Guy&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'fun-red': '#E85A4F',      /* Terracotta */
                        'fun-cream': '#FAF8F5',    /* Off-white */
                        'fun-dark': '#2C2A32',     /* Charcoal */
                        'fun-yellow': '#FFD166',   /* Pop Yellow */
                        'fun-green': '#06D6A0',    /* Pop Green */
                    },
                    fontFamily: {
                        'sans': ['DM Sans', 'sans-serif'],
                        'display': ['Space Grotesk', 'sans-serif'],
                        'pop': ['Luckiest Guy', 'cursive'],
                    },
                    boxShadow: {
                        'hard': '4px 4px 0px 0px #2C2A32',
                        'hard-hover': '2px 2px 0px 0px #2C2A32',
                        'hard-white': '4px 4px 0px 0px #FAF8F5',
                    }
                }
            }
        }
    </script>

    <style>
        /* CORE LAYOUT FIXES */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrolling */
        }

        body {
            background-color: #E85A4F; /* Fallback */
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 209, 102, 0.6) 0%, transparent 40%),
                radial-gradient(circle at 80% 20%, rgba(6, 214, 160, 0.5) 0%, transparent 40%),
                conic-gradient(from 45deg at 50% 50%, rgba(232, 90, 79, 0.2) 0deg, rgba(255, 209, 102, 0.2) 120deg, rgba(232, 90, 79, 0.2) 240deg),
                linear-gradient(135deg, #E85A4F 0%, #C93D32 100%);
            background-attachment: fixed;
            background-blend-mode: soft-light, soft-light, normal, normal;
            font-family: 'DM Sans', sans-serif;
            color: #2C2A32;
        }

        /* --- Falling Animation --- */
        @keyframes fall {
            0% { transform: translateY(-20vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.12; } 
            90% { opacity: 0.12; }
            100% { transform: translateY(120vh) rotate(360deg); opacity: 0; }
        }

        .falling-item {
            position: absolute;
            top: -20vh;
            color: #FAF8F5; /* Cream color */
            pointer-events: none;
            z-index: 0;
            animation: fall linear infinite;
        }

        /* --- Transitions --- */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: transparent;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform: translateY(100%);
            z-index: 10;
            pointer-events: none; /* CRITICAL FIX: Inactive screens cannot capture clicks */
        }

        .screen.active {
            transform: translateY(0);
            pointer-events: auto; /* CRITICAL FIX: Only active screen captures clicks */
        }

        .screen.prev {
            transform: translateY(-100%) scale(0.9);
            opacity: 0.5;
            pointer-events: none;
        }

        /* --- New Morphing Loader Styles --- */
        @keyframes morph-in {
            0% { transform: translate(-50%, -50%) scale(0.5) rotate(-20deg); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes morph-out {
            0% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1.2) rotate(20deg); opacity: 0; }
        }
        
        .icon-morph-enter {
            animation: morph-in 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        .icon-morph-exit {
            animation: morph-out 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        /* Float Animation for Title */
        @keyframes float-text {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .animate-float { animation: float-text 3s ease-in-out infinite; }

        /* Updated Mega Pulse Animation */
        @keyframes pulse-mega {
            0% { transform: scale(0.9); opacity: 0.7; }
            100% { transform: scale(3); opacity: 0; }
        }
        .animate-pulse-fun {
            animation: pulse-mega 2s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
        }

        #rain-container {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* Hide scrollbar for horizontal scroll */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        /* Cursor change for drag scroll */
        .cursor-grab { cursor: grab; }
        .cursor-grabbing { cursor: grabbing; }

        /* Autocomplete List Styling */
        #autocomplete-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 4px solid #2C2A32;
            border-radius: 1rem;
            margin-top: 8px;
            z-index: 50;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 4px 4px 0px 0px #2C2A32;
        }
        .suggestion-item {
            padding: 12px 16px;
            border-bottom: 2px solid #f0f0f0;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-item:hover { background-color: #FAF8F5; }

        /* Custom Range Slider */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
            position: relative;
            z-index: 10;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 32px;
            width: 32px;
            border-radius: 50%;
            background: #FFD166;
            border: 4px solid #2C2A32;
            cursor: pointer;
            margin-top: -12px;
            box-shadow: 2px 2px 0px 0px #2C2A32;
            transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #FAF8F5;
            border: 2px solid #2C2A32;
            border-radius: 999px;
        }

        /* Bubble styles */
        .bubble-svg {
            fill: #FFD166;
            stroke: #2C2A32;
            stroke-width: 3px;
            filter: drop-shadow(2px 2px 0px #2C2A32);
        }
        .bubble-text {
            position: absolute;
            top: 50%; /* Centered vertically */
            left: 55%;
            transform: translate(-50%, -55%); /* Slight offset for optical center */
            font-family: 'DM Sans', sans-serif;
            font-weight: 800;
            font-size: 0.8rem;
            color: #2C2A32;
            white-space: nowrap;
        }

        /* Loader Icon Specifics */
        #morph-container img {
            width: 140px; /* Increased size for visibility */
            height: 140px;
            position: absolute;
            top: 50%;
            left: 50%;
            /* Transform handled by animation keyframes */
        }

    </style>
</head>
<body>

    <!-- BACKGROUND ANIMATION CONTAINER -->
    <div id="rain-container"></div>

    <!-- GET HELP BUTTON (Fixed Position) -->
    <button onclick="alert('Help is coming! Just follow the big buttons for now.')" class="fixed top-5 right-5 z-50 bg-fun-cream text-fun-dark border-[3px] border-fun-dark rounded-full p-2 shadow-hard-hover hover:scale-110 active:scale-95 transition-transform group" title="Get Help">
        <i data-lucide="help-circle" class="w-6 h-6 group-hover:rotate-12 transition-transform"></i>
    </button>

    <!-- CUSTOM DATE PICKER MODAL -->
    <div id="date-modal" class="fixed inset-0 z-[100] hidden items-center justify-center p-4 bg-fun-dark/80 backdrop-blur-sm animate-fade-in">
        <div class="bg-fun-cream w-full max-w-sm border-[4px] border-fun-dark rounded-3xl p-6 shadow-hard relative">
            <button onclick="closeDatePicker()" class="absolute top-4 right-4 text-fun-dark hover:scale-110 transition-transform">
                <i data-lucide="x-circle" class="w-8 h-8 stroke-[2.5px]"></i>
            </button>
            
            <h3 class="font-pop text-3xl text-fun-dark mb-2 text-center">Pick a Time</h3>
            <p class="text-center font-bold text-fun-dark/60 mb-6">When should we eat?</p>
            
            <div class="bg-white border-2 border-fun-dark rounded-xl p-4 mb-6 shadow-inner">
                <input type="datetime-local" id="modal-date-input" class="w-full bg-transparent font-sans font-bold text-xl text-fun-dark outline-none">
            </div>

            <button onclick="confirmDate()" class="w-full bg-fun-green border-[3px] border-fun-dark rounded-xl py-3 font-pop text-xl uppercase shadow-hard hover:translate-y-1 hover:shadow-none transition-all">
                Confirm
            </button>
        </div>
    </div>

    <!-- STEP 1: INTRO -->
    <div id="step-1" class="screen active p-6 justify-center items-center gap-12 z-20">
        
        <!-- Top Section: Big Text -->
        <div class="text-center relative animate-float">
            <h1 class="font-display text-6xl md:text-7xl leading-[0.9] text-white drop-shadow-[5px_5px_0px_rgba(45,52,54,1)] tracking-tighter mb-4 flex flex-col items-center">
                <span class="transform -rotate-6 transition hover:rotate-0 duration-300">TOO</span>
                <span class="transform rotate-3 transition hover:rotate-0 duration-300 text-fun-yellow">LAZY</span>
                <span class="transform -rotate-2 transition hover:rotate-0 duration-300">TO</span>
                <span class="transform rotate-6 transition hover:rotate-0 duration-300">PICK?</span>
            </h1>
            <div class="inline-block bg-fun-dark text-fun-cream px-4 py-2 rounded-full transform -rotate-2 mt-4 shadow-hard-white">
                <p class="font-bold tracking-widest uppercase text-sm">We choose, you eat.</p>
            </div>
        </div>

        <!-- Bottom Section: Big Round Button -->
        <div class="relative w-full h-64 flex justify-center items-center z-10 mb-10">
            <!-- Decorative circle behind with pulse -->
            <div class="absolute w-56 h-56 bg-fun-cream/30 rounded-full animate-pulse-fun pointer-events-none"></div>
            
            <button onclick="console.log('Button Clicked'); goToStep(2)" class="group relative w-48 h-48 bg-fun-cream rounded-full border-[6px] border-fun-dark shadow-hard transition-all duration-200 hover:translate-y-[2px] hover:shadow-hard-hover active:scale-95 flex flex-col items-center justify-center gap-2 z-20 cursor-pointer">
                <span class="font-pop text-4xl uppercase tracking-wider text-fun-dark">feed me</span>
            </button>
        </div>
    </div>

    <!-- STEP 2: DETAILS -->
    <div id="step-2" class="screen p-6 z-30">
        <div class="flex-1 flex flex-col max-w-md mx-auto w-full pt-8 pb-32 h-full overflow-y-auto no-scrollbar">
            
            <!-- No Header -->

            <!-- Form Container -->
            <div class="flex flex-col gap-10 mt-4">
                
                <!-- Q1: Location + Distance Combined Group -->
                <div class="space-y-2">
                    <label class="block font-pop text-2xl text-fun-dark tracking-wide ml-2">Near where?</label>
                    
                    <!-- Location Input -->
                    <div class="relative group">
                        <div class="absolute -inset-1 bg-fun-dark rounded-2xl blur opacity-20 group-hover:opacity-40 transition"></div>
                        <div class="relative bg-fun-cream border-[4px] border-fun-dark rounded-2xl shadow-hard flex items-center p-2 focus-within:translate-y-[2px] focus-within:shadow-hard-hover transition-all">
                            <div class="ml-2 mr-3">
                                <i data-lucide="map-pin" class="w-6 h-6 text-fun-dark stroke-[3px]"></i>
                            </div>
                            <input type="text" id="loc-input" placeholder="City, neighborhood..." class="flex-1 min-w-0 bg-transparent font-sans font-medium text-lg text-fun-dark placeholder:text-fun-dark/40 outline-none" value="" autocomplete="off">
                            <button onclick="detectLocation()" class="ml-2 bg-fun-yellow text-fun-dark border-2 border-fun-dark px-3 py-1 rounded-xl text-xs font-bold uppercase tracking-wider hover:bg-white transition-colors flex items-center gap-1 shadow-hard-hover active:scale-95">
                                <i data-lucide="crosshair" class="w-3 h-3"></i>
                                Use My Location
                            </button>
                        </div>
                        <div id="autocomplete-list" class="hidden"></div>
                    </div>

                    <!-- Distance Slider Row (Below Input) -->
                    <div class="flex items-center gap-3 px-1 pt-4">
                        <!-- Slider (Takes remaining width) -->
                        <div class="flex-1 relative pt-2">
                            <input type="range" min="1" max="3" value="1" id="distance-range" oninput="updateDistanceLabel(this.value)">
                            <div class="flex justify-between mt-1 font-bold text-[10px] text-fun-dark/60 font-sans uppercase tracking-widest">
                                <span>Close</span>
                                <span>Far</span>
                            </div>
                        </div>

                        <!-- Tag Value (Right Side) -->
                        <div class="relative w-[90px] h-[40px] shrink-0 mt-1">
                            <svg class="w-full h-full overflow-visible" viewBox="0 0 100 45">
                                <!-- Tail points left -->
                                <path class="bubble-svg" d="M15 0 H90 A10 10 0 0 1 100 10 V35 A10 10 0 0 1 90 45 H15 A10 10 0 0 1 5 35 L0 22.5 L5 10 A10 10 0 0 1 15 0 Z"/>
                            </svg>
                            <span id="distance-text" class="bubble-text">Walkable</span>
                        </div>
                    </div>
                </div>

                <!-- Q2: When? (Fluid Scroll with Shadow) -->
                <div class="space-y-3 relative">
                    <label class="block font-pop text-2xl text-fun-dark tracking-wide ml-2">When?</label>
                    
                    <!-- Shadow Overlay -->
                    <div class="absolute right-0 top-10 bottom-0 w-16 bg-gradient-to-l from-fun-red/40 to-transparent pointer-events-none z-10 rounded-r-xl"></div>

                    <div id="time-scroll-container" class="flex gap-4 overflow-x-auto p-4 -mx-4 no-scrollbar cursor-grab active:cursor-grabbing select-none relative z-0">
                        <!-- Options -->
                        <label class="cursor-pointer group relative flex-none w-32">
                            <input type="radio" name="time" value="now" class="peer sr-only" checked>
                            <div class="h-full bg-fun-cream border-[4px] border-transparent peer-checked:border-fun-dark peer-checked:bg-fun-yellow peer-checked:shadow-hard rounded-2xl p-4 flex flex-col items-center justify-center gap-2 transition-all hover:bg-white/90">
                                <i data-lucide="clock" class="w-8 h-8 stroke-[2.5px] text-fun-dark"></i>
                                <span class="font-sans font-bold text-fun-dark uppercase tracking-tight text-center leading-none">Right Now</span>
                            </div>
                            <div class="absolute -top-1 -right-1 bg-fun-green border-2 border-fun-dark rounded-full p-1 opacity-0 peer-checked:opacity-100 transition-opacity shadow-hard-hover scale-0 peer-checked:scale-100 duration-200 z-10">
                                <i data-lucide="check" class="w-4 h-4 text-white stroke-[4px]"></i>
                            </div>
                        </label>

                        <label class="cursor-pointer group relative flex-none w-32">
                            <input type="radio" name="time" value="tonight" class="peer sr-only">
                            <div class="h-full bg-fun-cream border-[4px] border-transparent peer-checked:border-fun-dark peer-checked:bg-fun-yellow peer-checked:shadow-hard rounded-2xl p-4 flex flex-col items-center justify-center gap-2 transition-all hover:bg-white/90">
                                <i data-lucide="moon" class="w-8 h-8 stroke-[2.5px] text-fun-dark"></i>
                                <span class="font-sans font-bold text-fun-dark uppercase tracking-tight text-center leading-none">Tonight</span>
                            </div>
                            <div class="absolute -top-1 -right-1 bg-fun-green border-2 border-fun-dark rounded-full p-1 opacity-0 peer-checked:opacity-100 transition-opacity shadow-hard-hover scale-0 peer-checked:scale-100 duration-200 z-10">
                                <i data-lucide="check" class="w-4 h-4 text-white stroke-[4px]"></i>
                            </div>
                        </label>

                        <label class="cursor-pointer group relative flex-none w-32">
                            <input type="radio" name="time" value="tomorrow_lunch" class="peer sr-only">
                            <div class="h-full bg-fun-cream border-[4px] border-transparent peer-checked:border-fun-dark peer-checked:bg-fun-yellow peer-checked:shadow-hard rounded-2xl p-4 flex flex-col items-center justify-center gap-2 transition-all hover:bg-white/90">
                                <i data-lucide="sun" class="w-8 h-8 stroke-[2.5px] text-fun-dark"></i>
                                <span class="font-sans font-bold text-fun-dark uppercase tracking-tight text-center leading-none text-sm">Tomorrow Lunch</span>
                            </div>
                            <div class="absolute -top-1 -right-1 bg-fun-green border-2 border-fun-dark rounded-full p-1 opacity-0 peer-checked:opacity-100 transition-opacity shadow-hard-hover scale-0 peer-checked:scale-100 duration-200 z-10">
                                <i data-lucide="check" class="w-4 h-4 text-white stroke-[4px]"></i>
                            </div>
                        </label>

                        <label class="cursor-pointer group relative flex-none w-32">
                            <input type="radio" name="time" value="tomorrow_dinner" class="peer sr-only">
                            <div class="h-full bg-fun-cream border-[4px] border-transparent peer-checked:border-fun-dark peer-checked:bg-fun-yellow peer-checked:shadow-hard rounded-2xl p-4 flex flex-col items-center justify-center gap-2 transition-all hover:bg-white/90">
                                <i data-lucide="utensils-crossed" class="w-8 h-8 stroke-[2.5px] text-fun-dark"></i>
                                <span class="font-sans font-bold text-fun-dark uppercase tracking-tight text-center leading-none text-sm">Tomorrow Dinner</span>
                            </div>
                            <div class="absolute -top-1 -right-1 bg-fun-green border-2 border-fun-dark rounded-full p-1 opacity-0 peer-checked:opacity-100 transition-opacity shadow-hard-hover scale-0 peer-checked:scale-100 duration-200 z-10">
                                <i data-lucide="check" class="w-4 h-4 text-white stroke-[4px]"></i>
                            </div>
                        </label>

                         <label class="cursor-pointer group relative flex-none w-32">
                            <input type="radio" name="time" value="custom" class="peer sr-only" onclick="openDatePicker()">
                            <div class="h-full bg-fun-cream border-[4px] border-transparent peer-checked:border-fun-dark peer-checked:bg-fun-yellow peer-checked:shadow-hard rounded-2xl p-4 flex flex-col items-center justify-center gap-2 transition-all hover:bg-white/90">
                                <i data-lucide="calendar-plus" class="w-8 h-8 stroke-[2.5px] text-fun-dark"></i>
                                <span class="font-sans font-bold text-fun-dark uppercase tracking-tight text-center leading-none text-sm">Pick a moment</span>
                            </div>
                            <div class="absolute -top-1 -right-1 bg-fun-green border-2 border-fun-dark rounded-full p-1 opacity-0 peer-checked:opacity-100 transition-opacity shadow-hard-hover scale-0 peer-checked:scale-100 duration-200 z-10">
                                <i data-lucide="check" class="w-4 h-4 text-white stroke-[4px]"></i>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Q4: Picky Eater? (Ghost Style Button) -->
                <div>
                    <button onclick="document.getElementById('more-filters').classList.toggle('hidden')" class="w-full bg-transparent border-[3px] border-dashed border-fun-dark/50 rounded-2xl p-3 flex items-center justify-center gap-2 font-bold text-fun-dark/70 hover:bg-fun-cream/30 hover:border-fun-dark hover:text-fun-dark transition-all active:scale-95 font-pop tracking-wide text-lg">
                        <i data-lucide="chef-hat" class="w-6 h-6 stroke-[2.5px]"></i>
                        Picky Eater?
                    </button>
                    <!-- Placeholder area for future filters -->
                    <div id="more-filters" class="hidden mt-4 p-4 border-[3px] border-fun-dark/20 rounded-xl bg-black/10">
                        <p class="text-fun-cream/80 text-sm font-bold text-center italic">Advanced food science settings coming soon...</p>
                    </div>
                </div>

            </div>

            <!-- Sticky Bottom Action Button -->
            <div class="fixed bottom-8 left-0 right-0 px-6 z-50 flex justify-center pointer-events-none">
                <div class="w-full max-w-md pointer-events-auto relative">
                    <div class="absolute inset-0 bg-fun-dark rounded-2xl translate-y-2 translate-x-2"></div>
                    <button onclick="startSearch()" class="relative w-full bg-fun-green border-[4px] border-fun-dark rounded-2xl py-4 shadow-hard flex items-center justify-center gap-3 transition-transform active:translate-y-2 active:translate-x-2">
                        <span class="font-pop text-2xl text-fun-dark uppercase tracking-wide">Roll the Dice</span>
                        <i data-lucide="dices" class="w-8 h-8 stroke-[3px] text-fun-dark"></i>
                    </button>
                </div>
            </div>

        </div>
    </div>

    <!-- STEP 3: NEW MORPHING LOADER -->
    <div id="step-3" class="screen p-6 z-40 items-center justify-center flex-col">
        <!-- Background decorative pulse -->
        <div class="absolute w-[140vw] h-[140vw] bg-fun-cream/10 rounded-full animate-ping opacity-20 pointer-events-none" style="animation-duration: 3s"></div>
        
        <!-- The "Portal" Circle -->
        <div class="relative w-64 h-64 flex items-center justify-center mb-12">
            <!-- Outer rings -->
            <div class="absolute inset-0 border-[6px] border-fun-dark/20 rounded-full animate-[spin_10s_linear_infinite]"></div>
            <div class="absolute inset-4 border-[4px] border-fun-yellow rounded-full animate-[spin_8s_linear_infinite_reverse]"></div>
            
            <!-- Central Plate Background -->
            <div class="absolute inset-8 bg-fun-cream border-[6px] border-fun-dark rounded-full shadow-hard flex items-center justify-center overflow-hidden">
                <!-- The Morphing Icon Container -->
                <div id="morph-container" class="relative w-full h-full flex items-center justify-center">
                    <!-- Icons injected here by JS -->
                </div>
            </div>
        </div>

        <!-- Text Area -->
        <div class="text-center space-y-2 relative z-10">
            <h3 class="font-pop text-4xl text-fun-cream drop-shadow-[4px_4px_0px_#2C2A32] uppercase tracking-wide animate-pulse">Consulting...</h3>
            <p id="loading-msg" class="font-sans font-bold text-fun-dark bg-fun-cream/90 px-4 py-1 rounded-full border-2 border-fun-dark inline-block shadow-hard-hover">Checking the vibes</p>
        </div>
    </div>

    <!-- STEP 4: RESULT -->
    <div id="step-4" class="screen p-6 z-50 flex-col h-full">
        <!-- Content Container -->
        <div class="flex-1 flex flex-col w-full max-w-md mx-auto pt-8 pb-32 overflow-y-auto no-scrollbar">
            <!-- Header -->
            <div class="text-center mb-6 animate-float">
                <h2 class="font-pop text-4xl text-white drop-shadow-[3px_3px_0px_rgba(45,52,54,1)] uppercase transform -rotate-2">It's a Match!</h2>
            </div>

            <!-- Restaurant Card -->
            <div class="bg-white border-[5px] border-fun-dark rounded-3xl shadow-hard overflow-hidden flex-1 flex flex-col mb-6 transform rotate-1 hover:rotate-0 transition-transform duration-300 relative group min-h-[300px]">
                <!-- Image -->
                <div class="h-48 bg-gray-200 relative border-b-[5px] border-fun-dark overflow-hidden">
                     <img id="res-img" src="" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" alt="Food">
                     <div class="absolute top-3 right-3 bg-fun-yellow border-[3px] border-fun-dark px-3 py-1 rounded-xl font-bold text-fun-dark shadow-hard-hover text-sm">
                        <span id="res-price">$$$</span>
                     </div>
                </div>
                
                <!-- Content -->
                <div class="p-6 flex-1 flex flex-col relative">
                    <!-- Rating Badge overlapping image/content -->
                    <div class="absolute -top-5 left-6 bg-fun-green border-[3px] border-fun-dark px-3 py-1 rounded-full font-bold text-white shadow-hard-hover flex items-center gap-1 transform -rotate-3">
                        <i data-lucide="star" class="w-4 h-4 fill-white"></i>
                        <span id="res-rating">4.8</span>
                    </div>

                    <h3 id="res-name" class="font-pop text-3xl text-fun-dark leading-tight mb-2 mt-2">Taco Loco</h3>
                    <p id="res-desc" class="font-sans font-medium text-fun-dark/70 text-lg leading-snug mb-4 line-clamp-3">Authentic street tacos served from a truck that looks like a spaceship.</p>
                    
                    <div class="mt-auto space-y-3">
                         <div class="flex items-start gap-2 text-fun-dark font-bold font-sans">
                            <i data-lucide="map-pin" class="w-5 h-5 mt-0.5 shrink-0 text-fun-red"></i>
                            <span id="res-addr">55 Space Blvd</span>
                        </div>
                        <div class="flex gap-2 flex-wrap" id="res-tags">
                            <!-- Tags populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sticky Bottom Action Buttons (SIDE BY SIDE) -->
        <div class="fixed bottom-8 left-0 right-0 px-6 z-50 flex justify-center pointer-events-none">
            <div class="w-full max-w-md pointer-events-auto flex gap-3">
                
                <!-- Reroll Button (Yellow, Square-ish) -->
                <div class="relative w-1/3">
                    <div class="absolute inset-0 bg-fun-dark rounded-2xl translate-y-2 translate-x-2"></div>
                    <button onclick="retrySearch()" class="relative w-full h-full bg-fun-yellow border-[4px] border-fun-dark rounded-2xl shadow-hard flex items-center justify-center transition-transform active:translate-y-2 active:translate-x-2 hover:brightness-110">
                         <i data-lucide="refresh-cw" class="w-8 h-8 stroke-[3px] text-fun-dark"></i>
                    </button>
                </div>

                <!-- Let's Eat Button (Green, Wide) -->
                <div class="relative flex-1">
                    <div class="absolute inset-0 bg-fun-dark rounded-2xl translate-y-2 translate-x-2"></div>
                    <button onclick="alert('Opening Maps...')" class="relative w-full bg-fun-green border-[4px] border-fun-dark rounded-2xl py-4 shadow-hard flex items-center justify-center gap-2 transition-transform active:translate-y-2 active:translate-x-2 hover:brightness-110">
                        <span class="font-pop text-xl text-fun-dark uppercase tracking-wide">Let's Eat!</span>
                        <i data-lucide="navigation" class="w-6 h-6 stroke-[3px] text-fun-dark"></i>
                    </button>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- Vectorized SVGs (as Data URIs for tsparticles) ---
        const iconColor = "#2C2A32"; // FIXED: Use regular Hex so encodeURIComponent handles it correctly
        
        // Using encodeURIComponent for the SVG string to ensure special characters don't break the data URI
        const createSvgDataUri = (svg) => `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;

        // SOLID FILLED ICONS - High contrast, clearly recognizable
        
        const pizzaSvgRaw = `<svg viewBox="0 0 512 512" fill="${iconColor}" xmlns="http://www.w3.org/2000/svg"><path d="M464 64L32 256l224 224L464 64zm-243 234a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm96-64a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm-64-96a32 32 0 1 1 0-64 32 32 0 1 1 0 64z"/></svg>`; 
        
        const burgerSolid = `<svg viewBox="0 0 512 512" fill="${iconColor}" xmlns="http://www.w3.org/2000/svg"><path d="M464 288h-416c-26.5 0-48 21.5-48 48v32c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-32c0-26.5-21.5-48-48-48zM232 448h48v32h-48zM464 128H48C21.5 128 0 149.5 0 176v64c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-64c0-26.5-21.5-48-48-48z"/></svg>`;

        const hotdogSolid = `<svg viewBox="0 0 512 512" fill="${iconColor}" xmlns="http://www.w3.org/2000/svg"><path d="M160 64c-53 0-96 43-96 96v256c0 53 43 96 96 96h192c53 0 96-43 96-96V160c0-53-43-96-96-96H160zm0 64h192c17.7 0 32 14.3 32 32v224c0 17.7-14.3 32-32 32H160c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32z"/></svg>`;

        const drumstickSolid = `<svg viewBox="0 0 512 512" fill="${iconColor}" xmlns="http://www.w3.org/2000/svg"><path d="M416 0C327.6 0 256 71.6 256 160c0 18.2 3.1 35.7 8.8 52.1L24 452.3c-12.7 12.7-12.7 33.4 0 46.1l9.4 9.4c12.7 12.7 33.4 12.7 46.1 0L319.9 264.8c16.4 5.7 33.9 8.8 52.1 8.8 88.4 0 160-71.6 160-160S460.4 0 416 0z"/></svg>`;

        const iceCreamSolid = `<svg viewBox="0 0 448 512" fill="${iconColor}" xmlns="http://www.w3.org/2000/svg"><path d="M346 136c0-66.3-53.7-120-120-120s-120 53.7-120 120v24c0 23.3 10.3 45.3 28.1 60.1l7.9 6.6-47.6 166.4C82.1 433.8 102.3 472 139.3 472h169.3c37 0 57.2-38.2 44.9-78.9l-47.6-166.4 7.9-6.6c17.8-14.8 28.1-36.8 28.1-60.1v-24zM168 136c0-30.9 25.1-56 56-56s56 25.1 56 56v8h-112v-8z"/></svg>`;

        const sodaSolid = `<svg viewBox="0 0 512 512" fill="${iconColor}" xmlns="http://www.w3.org/2000/svg"><path d="M32 64C32 28.7 60.7 0 96 0h128c35.3 0 64 28.7 64 64v32h64c17.7 0 32 14.3 32 32v224c0 17.7-14.3 32-32 32H352v64c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V64zm256 64v224h64V128H288zM96 64v384h192V64H96z"/></svg>`;

        // Reassigning to standard names used in logic
        const pizzaSvg = createSvgDataUri(pizzaSvgRaw);
        const burgerSvg = createSvgDataUri(burgerSolid);
        const hotdogSvg = createSvgDataUri(hotdogSolid);
        const drumstickSvg = createSvgDataUri(drumstickSolid);
        const iceCreamSvg = createSvgDataUri(iceCreamSolid);
        const sodaSvg = createSvgDataUri(sodaSolid);

        function goToStep(step) {
            document.querySelectorAll('.screen').forEach(el => {
                el.classList.remove('active');
                if(!el.classList.contains('prev')) el.classList.add('prev');
            });
            const target = document.getElementById(`step-${step}`);
            target.classList.remove('prev');
            target.classList.add('active');
            
            // Handle Rain Visibility: ONLY for Step 1
            const rain = document.getElementById('rain-container');
            if(step === 1) {
                rain.style.opacity = '1';
            } else {
                rain.style.opacity = '0';
            }

            setTimeout(() => lucide.createIcons(), 100);

            if (step === 2) {
                detectLocation();
                updateDistanceLabel(document.getElementById('distance-range').value);
            }
        }

        function detectLocation() {
            const input = document.getElementById('loc-input');
            if (!input.value) { 
                if ("geolocation" in navigator) {
                    input.placeholder = "Locating...";
                    navigator.geolocation.getCurrentPosition(function(position) {
                        input.value = `Near you`;
                    }, function(error) {
                        input.value = "";
                        input.placeholder = "City, neighborhood...";
                    });
                } else {
                    input.value = "";
                }
            }
        }

        // Auto-complete logic
        const input = document.getElementById('loc-input');
        const autocompleteList = document.getElementById('autocomplete-list');
        const mockSuggestions = ["Downtown", "Times Square", "Brooklyn Bridge", "Central Park", "The Mission", "SoHo", "Chinatown"];

        input.addEventListener('input', function() {
            const val = this.value;
            autocompleteList.innerHTML = '';
            if (!val) {
                autocompleteList.classList.add('hidden');
                return;
            }
            const matches = mockSuggestions.filter(item => item.toLowerCase().includes(val.toLowerCase()));
            if (matches.length > 0) {
                autocompleteList.classList.remove('hidden');
                matches.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'suggestion-item';
                    div.innerHTML = `<i data-lucide="map-pin" class="w-4 h-4 text-gray-400"></i> ${item}`;
                    div.addEventListener('click', function() {
                        input.value = item;
                        autocompleteList.classList.add('hidden');
                    });
                    autocompleteList.appendChild(div);
                });
                lucide.createIcons();
            } else {
                autocompleteList.classList.add('hidden');
            }
        });

        document.addEventListener('click', function(e) {
            if (e.target !== input) {
                autocompleteList.classList.add('hidden');
            }
        });

        function openDatePicker() {
            document.getElementById('date-modal').classList.remove('hidden');
            document.getElementById('date-modal').classList.add('flex');
        }

        function closeDatePicker() {
            document.getElementById('date-modal').classList.add('hidden');
            document.getElementById('date-modal').classList.remove('flex');
        }

        function confirmDate() {
            const val = document.getElementById('modal-date-input').value;
            console.log("Date selected:", val);
            closeDatePicker();
        }

        function updateDistanceLabel(val) {
            const labelText = document.getElementById('distance-text');
            const labels = ["Close", "Short Drive", "Adventure"];
            labelText.innerText = labels[val - 1];
        }

        function initDragScroll() {
            const slider = document.getElementById('time-scroll-container');
            let isDown = false;
            let startX;
            let scrollLeft;

            slider.addEventListener('mousedown', (e) => {
                isDown = true;
                slider.classList.add('cursor-grabbing');
                slider.classList.remove('cursor-grab');
                startX = e.pageX - slider.offsetLeft;
                scrollLeft = slider.scrollLeft;
            });
            slider.addEventListener('mouseleave', () => {
                isDown = false;
                slider.classList.remove('cursor-grabbing');
                slider.classList.add('cursor-grab');
            });
            slider.addEventListener('mouseup', () => {
                isDown = false;
                slider.classList.remove('cursor-grabbing');
                slider.classList.add('cursor-grab');
            });
            slider.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.pageX - slider.offsetLeft;
                const walk = (x - startX) * 2;
                slider.scrollLeft = scrollLeft - walk;
            });
            slider.addEventListener('wheel', (evt) => {
                evt.preventDefault();
                slider.scrollLeft += evt.deltaY;
            });
        }

        // --- NEW MORPHING LOADER LOGIC ---
        function startSearch() {
            goToStep(3);
            
            const container = document.getElementById('morph-container');
            const svgsDataUris = [pizzaSvg, burgerSvg, hotdogSvg, drumstickSvg, iceCreamSvg, sodaSvg];
            let index = 0;

            // Function to show next icon
            const showNextIcon = () => {
                // Clear previous
                container.innerHTML = '';
                
                // Create new image
                const img = document.createElement('img');
                img.src = svgsDataUris[index];
                img.className = 'icon-morph-enter'; // Add entry animation class
                container.appendChild(img);

                // Setup exit
                setTimeout(() => {
                    img.classList.remove('icon-morph-enter');
                    img.classList.add('icon-morph-exit');
                }, 600); // Start exit halfway

                index = (index + 1) % svgsDataUris.length;
            };

            // Start immediately
            showNextIcon();
            
            // Loop
            const morphInterval = setInterval(showNextIcon, 800);

            // Messages
            const messages = [
                "Consulting the stars...",
                "Scanning hunger levels...",
                "Avoiding kale smoothies...",
                "Calibrating taste buds...",
                "Rolling for flavor...",
            ];
            const msgEl = document.getElementById('loading-msg');
            let msgIndex = 0;
            
            const msgInterval = setInterval(() => {
                msgEl.innerText = messages[msgIndex];
                msgIndex = (msgIndex + 1) % messages.length;
            }, 800);

            // Finish
            setTimeout(() => {
                clearInterval(morphInterval);
                clearInterval(msgInterval);
                showResult();
            }, 4000); 
        }

        function showResult() {
            // Randomly select a mock restaurant
            const places = [
                { name: "Taco Loco", img: "https://images.unsplash.com/photo-1565299585323-38d6b0865b47?w=600&q=80", price: "$", rating: "4.9", desc: "Authentic street tacos served from a truck that looks like a spaceship.", addr: "55 Space Blvd", tags: ["Mexican", "Tacos"] },
                { name: "Burger King (JK)", img: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=600&q=80", price: "$$", rating: "4.5", desc: "Just kidding, it's 'The Burger King' - royalty worthy burgers.", addr: "1 Castle Rd", tags: ["Burgers", "American"] },
                { name: "Sushi Zen", img: "https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=600&q=80", price: "$$$", rating: "4.8", desc: "Zen garden atmosphere with sushi that melts in your mouth.", addr: "88 Peace Lane", tags: ["Japanese", "Sushi"] },
                { name: "Pasta La Vista", img: "https://images.unsplash.com/photo-1551183053-bf91a1d81141?w=600&q=80", price: "$$", rating: "4.2", desc: "Hasta la vista, hunger! Huge portions of mama's pasta.", addr: "Terminator St", tags: ["Italian", "Pasta"] }
            ];

            const choice = places[Math.floor(Math.random() * places.length)];
            
            document.getElementById('res-name').innerText = choice.name;
            document.getElementById('res-img').src = choice.img;
            document.getElementById('res-price').innerText = choice.price;
            document.getElementById('res-rating').innerText = choice.rating;
            document.getElementById('res-desc').innerText = choice.desc;
            document.getElementById('res-addr').innerText = choice.addr;
            
            // Clear and add tags
            const tagsContainer = document.getElementById('res-tags');
            tagsContainer.innerHTML = '';
            choice.tags.forEach(tag => {
                const span = document.createElement('span');
                span.className = "px-2 py-1 bg-fun-cream border-2 border-fun-dark rounded-lg text-xs font-bold";
                span.innerText = tag;
                tagsContainer.appendChild(span);
            });

            goToStep(4);
        }

        function retrySearch() {
            // Simply go back to step 3 to restart animation
            startSearch();
        }

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            initDragScroll();
            
            if(window.tsParticles) {
                tsParticles.load("rain-container", {
                    particles: {
                        number: { value: 8 },
                        shape: {
                            type: "image",
                            // Constraint 1: Only pizza slice in background rain
                            image: [
                                { src: pizzaSvg, width: 100, height: 100 }
                            ]
                        },
                        opacity: { value: 0.12, random: false },
                        size: { value: { min: 40, max: 80 }, random: true },
                        move: {
                            enable: true,
                            speed: 3,
                            direction: "bottom",
                            random: false,
                            straight: false,
                            outModes: { default: "out" },
                        },
                        rotate: {
                            value: 0,
                            random: true,
                            direction: "clockwise",
                            animation: { enable: true, speed: 5, sync: false }
                        }
                    },
                    interactivity: { detectsOn: "canvas", events: { resize: true } },
                    detectRetina: true
                });
            }
        });
    </script>
</body>
</html>